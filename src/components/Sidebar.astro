---
/**
 * 경로 기반 사이드바 필터링
 * Starlight 기본 Sidebar를 오버라이드하여 현재 섹션만 표시
 */
import MobileMenuFooter from 'virtual:starlight/components/MobileMenuFooter';
import SidebarPersister from '@astrojs/starlight/components/SidebarPersister.astro';
import SidebarSublist from '@astrojs/starlight/components/SidebarSublist.astro';

const { sidebar } = Astro.locals.starlightRoute;
const pathname = Astro.url.pathname;

const sectionMap: Record<string, string> = {
  '/log/vulkan/': 'Vulkan',
  '/log/misc/': 'Articles',
  '/vulkan/': 'Vulkan',
  '/cuda/': 'CUDA',
  '/articles/': 'Articles',
};

let sectionLabel: string | null = null;
for (const [prefix, label] of Object.entries(sectionMap)) {
  if (pathname.startsWith(prefix)) {
    sectionLabel = label;
    break;
  }
}

const filteredSidebar = sectionLabel
  ? sidebar.filter((entry: any) => entry.label === sectionLabel)
  : sidebar;
---

<SidebarPersister>
	<SidebarSublist sublist={filteredSidebar} />
</SidebarPersister>

<div class="md:sl-hidden">
	<MobileMenuFooter />
</div>
