---
/**
 * 경로 기반 사이드바 필터링
 * - /vulkan/* → "Vulkan" 그룹만
 * - /cuda/*   → "CUDA" 그룹만
 * - /articles/* → "Articles" 그룹만
 * - /log/*    → "학습 로그" 그룹만
 * - /        → 사이드바 없음 (splash)
 */
import Default from '@astrojs/starlight/components/Sidebar.astro';

const pathname = Astro.url.pathname;

const sectionMap: Record<string, string> = {
  '/vulkan/': 'Vulkan',
  '/cuda/': 'CUDA',
  '/articles/': 'Articles',
  '/log/': '학습 로그',
};

// 현재 경로에 맞는 섹션 라벨 찾기
let sectionLabel: string | null = null;
for (const [prefix, label] of Object.entries(sectionMap)) {
  if (pathname.startsWith(prefix)) {
    sectionLabel = label;
    break;
  }
}

// 해당 섹션 그룹만 필터링 + 자동 펼침
const sidebar = Astro.props.sidebar ?? [];
const filteredSidebar = sectionLabel
  ? sidebar
      .filter((entry: any) => entry.type === 'group' && entry.label === sectionLabel)
      .map((entry: any) => ({ ...entry, collapsed: false }))
  : sidebar;
---

<Default {...Astro.props} sidebar={filteredSidebar} />
